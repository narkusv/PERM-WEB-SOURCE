<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>PERM Log On form</title>
    <link href="../Content/bootstrap.min.css" rel="stylesheet" />
    <script src="../scripts/jquery-1.9.1.min.js"></script>
    <script src="../scripts/bootstrap.min.js"></script>
    <script src="../scripts/errorhandling.js"></script>

    <script language="javascript">
        function checkInput()/*function to check userid & password*/
        {
            /*the following code checkes whether the entered userid and password are matching*/
            /*var eMail  = document.getElementById("login-username").value;
            var uPsw = document.getElementById("login-password").value;*/
            var err = "";
          //  var minNumberofChars = 6;
          //  var maxNumberofChars = 16;

           /* var reU = /^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;

            if (reU.test(eMail) == false)
            {
                err += "User name is not valid. Userame should be user@email.adress <br>";
            }*/

          /*  var reP = /^(?=.*[0-9])(?=.*[!@#$%^&*])[a-zA-Z0-9!@#$%^&*]{6,16}$/;

            if (uPsw.length < minNumberofChars || uPsw.length > maxNumberofChars) {
                err += "Password length must be 6-16 symobols long. <br>";
            }

            if (reP.test(uPsw) == false)
            {
                err += "Password should contain atleast one digit and one special character !@#$%^&* <br>";
            }*/
            err = checkPassword(document.getElementById("login-password").value) + checkUsername(document.getElementById("login-username").value)

            if (err != "")
            {
                //change style form none to bloc and add content
                document.getElementById("login-alert").style.display = "block";
                document.getElementById("login-alert").innerHTML = err;
                document.getElementById("login-password").value = "";
            }
            else
            {
                User = new Object();
                User.userName = $("#login-username").val();
                User.userPassword = $("#login-password").val();
                logInUser(User);
            }
        }
        function checkPassword(password)
        {
            var minNumberofChars = 6;
            var maxNumberofChars = 16;
            var response = "";
            var reP = /^(?=.*[0-9])(?=.*[!@#$%^&*])[a-zA-Z0-9!@#$%^&*]{6,16}$/;

            if (password.length < minNumberofChars || password.length > maxNumberofChars) {
                response += "Password length must be 6-16 symobols long. <br>";
            }

            if (reP.test(password) == false) {
                response += "Password should contain atleast one digit and one special character !@#$%^&* <br>";
            }
            return response;
        }
        function checkUsername(username)
        {
            var response = "";
            var reU = /^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;

            if (reU.test(username) == false) {
                response = "User name is not valid. Userame should be user@email.adress <br>";
            }
            return response
        }

        function logInUser(User) {
            $.ajax({
                url: "/api/User/",
                type: 'POST',
                contentType: "application/json;charset=utf-8",
                data: JSON.stringify(User),
                success: function (response) {
                    saveCookie(response);
                },
                error: function (request, message, error) {
                    handleException(request, message, error);
                }
            });
        }
        function saveCookie(cookie)
        {
            document.cookie = "PERMCookie=" + cookie + " expires=Fri, 31 Dec 9999 23:59:59 GMT";
        }
    </script>

</head>
<body>
    <div class="container">
        <div id="loginbox" style="margin-top:50px;" class="mainbox col-md-6 col-md-offset-3 col-sm-8 col-sm-offset-2">
            <div class="panel panel-info">
                <div class="panel-heading">
                    <div class="panel-title">PERM Sign In</div>
                    <div style="float:right; font-size: 80%; position: relative; top:-10px"><a href="#">Forgot password?</a></div>
                </div>

                <div style="padding-top:30px" class="panel-body">

                    <div style="display:none" id="login-alert" class="alert alert-danger col-sm-12"></div>

                    <form id="loginform" class="form-horizontal" role="form">

                        <div style="margin-bottom: 25px" class="input-group">
                            <span class="input-group-addon"><i class="glyphicon glyphicon-user"></i></span>
                            <input id="login-username" type="text" class="form-control" name="username" value="" placeholder="user email">
                        </div>

                        <div style="margin-bottom: 25px" class="input-group">
                            <span class="input-group-addon"><i class="glyphicon glyphicon-lock"></i></span>
                            <input id="login-password" type="password" class="form-control" name="password" placeholder="password">
                        </div>

                        <div class="input-group">
                            <div class="checkbox">
                                <label>
                                    <input id="login-remember" type="checkbox" name="remember" value="1"> Remember me
                                </label>
                            </div>
                        </div>

                        <div style="margin-top:10px" class="form-group">
                            <!-- Button -->

                            <div class="col-sm-12 controls">
                                <a id="btn-login" onclick="checkInput()" class="btn btn-success">Login </a>
                                <a id="btn-fblogin" href="#" class="btn btn-primary">Login with FB</a>
                            </div>
                        </div>

                        <div class="form-group">
                            <div class="col-md-12 control">
                                <div style="border-top: 1px solid#888; padding-top:15px; font-size:85%">
                                    Not a PERM user?
                                    <a href="Register.html">Sign Up</a>
                                </div>
                            </div>
                        </div>
                    </form>

                </div>
            </div>
        </div>
    </div>
</body>
</html>